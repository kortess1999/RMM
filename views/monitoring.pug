extends layout
block content
    script
        | $(document).ready(async function() {
        |     await $('#data_table').DataTable( {
        |       "order":[[1,'asc'],[0,'asc']],
        |       language:{
        |   "decimal":        "",
        |   "emptyTable":     "Нет данных в таблице",
        |   "info":           "Предоставляет с _START_ по _END_ из _TOTAL_ элементов",
        |   "infoEmpty":      "Нет данных",
        |   "infoFiltered":   "(Отфильтровано из _MAX_ всего элементов)",
        |   "infoPostFix":    "",
        |   "thousands":      ",",
        |   "lengthMenu":     "Показывать _MENU_ элементов",
        |   "loadingRecords": "Загрузка...",
        |   "processing":     "Обработка...",
        |   "search":         "Поиск:  ",
        |   "zeroRecords":    "Нет совпадений",
        |   "paginate": {
        |      "first":      " Первая ",
        |      "last":       " Последняя ",
        |      "next":       " Следующая ",
        |      "previous":   " Предыдущая "
        |   },
        |   "aria": {
        |       "sortAscending":  ": нажмите для сортировки колонки по возрастанию",
        |       "sortDescending": ": нажмите для сортировки колонки по убыванию"
        |   }}
        |   })
        |   $('#data_table_info').addClass("dTable")
        |   $('#data_table_wrapper').addClass("marg")
        |   setTimeout(()=>{location.reload()},3*60*1000);
        | });
    nav(class="navbar navbar-dark bg-dark Padd")
        div(class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none")
            svg(class="bi me-2" width="40" height="32")
                svg(xmlns="http://www.w3.org/2000/svg" width="40" height="32" fill="currentColor" class="bi bi-diagram-3" viewBox="0 0 16 16")
                    path(fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1zM0 11.5A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm4.5.5A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z")
            svg(class="bi me-2" width="16" height="16")
            span(class="fs-4") Навигационная панель
        a(href="" class="btn btn-primary btn-lg")
            svg(class="bi me-2" width="16" height="16")
                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-building" viewBox="0 0 16 16")
                    path(fill-rule="evenodd" d="M14.763.075A.5.5 0 0 1 15 .5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V14h-1v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V10a.5.5 0 0 1 .342-.474L6 7.64V4.5a.5.5 0 0 1 .276-.447l8-4a.5.5 0 0 1 .487.022zM6 8.694L1 10.36V15h5V8.694zM7 15h2v-1.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V15h2V1.309l-7 3.5V15z")
                    path(d="M2 11h1v1H2v-1zm2 0h1v1H4v-1zm-2 2h1v1H2v-1zm2 0h1v1H4v-1zm4-4h1v1H8V9zm2 0h1v1h-1V9zm-2 2h1v1H8v-1zm2 0h1v1h-1v-1zm2-2h1v1h-1V9zm0 2h1v1h-1v-1zM8 7h1v1H8V7zm2 0h1v1h-1V7zm2 0h1v1h-1V7zM8 5h1v1H8V5zm2 0h1v1h-1V5zm2 0h1v1h-1V5zm0-2h1v1h-1V3z")
            svg(class="bi me-2" width="16" height="16")
            | Состояние модулей
        a(href="/reports" class="btn btn-secondary btn-lg text-white")
            svg(class="bi me-2" width="16" height="16")
                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-archive" viewBox="0 0 16 16")
                    path(d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1V2zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5H2zm13-3H1v2h14V2zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z")
            svg(class="bi me-2" width="16" height="16")
            | Отчёты
        if session.user.role === 'Администратор'
            a(href="/users" class="btn btn-secondary btn-lg")
                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-person" viewBox="0 0 16 16")
                    path(d="M12 1a1 1 0 0 1 1 1v10.755S12 11 8 11s-5 1.755-5 1.755V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z")
                    path(d="M8 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z")
                |  Управление пользователями
        a(class="btn btn-light" href="/quit") Выход
    table(class="table table-dark" id="data_table")
        thead
            tr
                th(scope='col') №Модуля
                th(scope='col') Состояние
                th(scope='col') Адрес
                th(scope='col') Свободно
                th(scope='col') Элементы управления
        tbody
            each mod in modules_list
                if modules[mod.id]
                    if modules[mod.id].errorType!==''
                        tr.table-danger
                            th(scope="row")=mod.id
                            th(scope="row")="Авария:"+modules[mod.id].errorType
                            th(scope="row")=mod.address
                            th(scope="row")
                                div(align="center")
                                    if modules[mod.id].state.IsBusy
                                        svg(xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="brown" class="bi bi-circle-fill" viewBox="0 0 16 16")
                                            circle(cx="8" cy="8" r="8")
                                    else
                                        svg(xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="forestgreen" class="bi bi-circle-fill" viewBox="0 0 16 16")
                                            circle(cx="8" cy="8" r="8")
                            th(scope="row")
                                div.col
                                    div.row
                                        button(type="button" onclick=`window.location.href = '/refresh/${mod.id}'` class="btn btn-secondary")
                                            svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16")
                                                path(d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z")
                                                path(d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z")
                                            |   Запросить данные
                                        button(type="button" onclick=`window.location.href = '/restart/${mod.id}'` class="btn btn-success")
                                            svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16")
                                                path(d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z")
                                                path(fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z")
                                            |   Перезапуск
                                    div.row
                                        if modules[mod.id].state.IsWorking
                                            button(type="button" onclick=`window.location.href = '/lock/${mod.id}'` class="btn btn-outline-danger")
                                                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock" viewBox="0 0 16 16")
                                                    path(d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z")
                                                |   Остановить обслуживание
                                        else
                                            button(type="button" onclick=`window.location.href = '/lock/${mod.id}'` class="btn btn-success")
                                                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-unlock" viewBox="0 0 16 16")
                                                    path(d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z")
                                                |   Запустить обслуживание
                    else
                        tr
                            th(scope="row")=mod.id
                            th(scope="row") Норма
                            th(scope="row")=mod.address
                            th(scope="row")
                                div(align="center")
                                    if modules[mod.id].state.IsBusy
                                        svg(xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="brown" class="bi bi-circle-fill" viewBox="0 0 16 16")
                                            circle(cx="8" cy="8" r="8")
                                    else
                                        svg(xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="forestgreen" class="bi bi-circle-fill" viewBox="0 0 16 16")
                                            circle(cx="8" cy="8" r="8")
                            th(scope="row")
                                div.col
                                    div.row
                                        button(type="button" onclick=`window.location.href = '/refresh/${mod.id}'` class="btn btn-secondary")
                                            svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16")
                                                path(d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z")
                                                path(d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z")
                                            |   Запросить данные
                                        button(type="button" onclick=`window.location.href = '/restart/${mod.id}'` class="btn btn-success")
                                            svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill='currentColor' class="bi bi-arrow-repeat" viewBox="0 0 16 16")
                                                path(d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z")
                                                path(fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z")
                                            |   Перезапуск
                                    div.row
                                        if modules[mod.id].state.IsWorking
                                            button(type="button" onclick=`window.location.href = '/lock/${mod.id}'` class="btn btn-outline-danger")
                                                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock" viewBox="0 0 16 16")
                                                    path(d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z")
                                                |   Остановить обслуживание
                                        else
                                            button(type="button" onclick=`window.location.href = '/lock/${mod.id}'` class="btn btn-success")
                                                svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="brown" class="bi bi-unlock" viewBox="0 0 16 16")
                                                    path(d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z")
                                                |   Запустить обслуживание
                else
                    tr.table-danger
                        th(scope="row")=mod.id
                        th(scope="row") Авария: Нет связи
                        th(scope="row")=mod.address
                        th(scope="row")
                            div(align="center")
                                svg(xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="darkgrey" class="bi bi-circle-fill" viewBox="0 0 16 16")
                                    circle(cx="8" cy="8" r="8")
                        th(scope="row") Нет связи

